## QUẢN LÝ BẢNG CÂN ĐỐI KẾ TOÁN
DANH_SACH_GOC_BCDKT=SELECT * FROM BALANCE_ASSET_ITEM WHERE ASSET_PARENT IS NULL OR ASSET_PARENT='' ORDER BY ASSET_CODE
DANH_SACH_CON_BCDKT=SELECT * FROM BALANCE_ASSET_ITEM WHERE ASSET_PARENT = ? ORDER BY ASSET_CODE
DANH_SACH_CON_TKKT=SELECT TKKT.*, CDKT.SO_DU AS SO_DU_GIA_TRI FROM CDKT_TAIKHOAN AS CDKT, TAI_KHOAN_DANH_MUC AS TKKT WHERE CDKT.MA_TK=TKKT.MA_TK AND CDKT.ASSET_CODE = ? ORDER BY TKKT.MA_TK

## CẬP NHẬT BẢNG CÂN ĐỐI KẾ TOÁN
DANH_SACH_TKKT_THUOC_NHIEU_CHI_TIEU=SELECT MA_TK, SO_DU AS SO_DU_GIA_TRI FROM CDKT_TAIKHOAN GROUP BY MA_TK, SO_DU HAVING COUNT(*)>1
DANH_SACH_CDKT_THEO_TKKT=SELECT * FROM BALANCE_ASSET_ITEM WHERE ASSET_CODE IN (SELECT DISTINCT ASSET_CODE FROM CDKT_TAIKHOAN WHERE MA_TK=? AND SO_DU=?)
DANH_SACH_TKKT_THEO_DIEU_KIEN=SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.SO_TIEN AS TONG_SO_TIEN, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, TK.MA_TK, TKDM.TEN_TK, TK.SO_TIEN, TK.LY_DO, TK.SO_DU, TK.ASSET_CODE, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TK.MA_CT AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND (TK.MA_TK LIKE '$MA_TK$%') AND NGAY_HT >= ? AND NGAY_HT <= ? AND TK.SO_DU=? \
	ORDER BY NGAY_HT, LOAI_CT, MA_CT, MA_TK
CAP_NHAT_CAN_DOI_KE_TOAN=UPDATE CHUNG_TU_TAI_KHOAN SET ASSET_CODE=? WHERE MA_CT=? AND MA_TK=? AND SO_DU=?

LAY_CDKT_KY_TRUOC=SELECT END_VALUE FROM BALANCE_ASSET_DATA WHERE ASSET_CODE=? AND PERIOD_TYPE=? AND PERIOD=?
TINH_CDKT_THEO_MATK=SELECT SUM(CTTK.SO_TIEN*CT.TY_GIA) FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS CTTK, CDKT_TAIKHOAN AS CDKT \
	WHERE CT.MA_CT=CTTK.MA_CT AND CTTK.MA_TK=CDKT.MA_TK AND CTTK.SO_DU=CDKT.SO_DU \
		AND (CTTK.ASSET_CODE IS NULL OR CDKT.ASSET_CODE=?) AND (CTTK.MA_TK LIKE '$MA_TK$%' AND CTTK.SO_DU=?) \
		AND CT.NGAY_HT >= ? AND CT.NGAY_HT <= ? \
	GROUP BY CTTK.MA_TK, CTTK.SO_DU


## QUẢN LÝ CHỨNG TỪ
## Phần quản lý phiếu thu, phiếu chi, báo nợ, báo có (gọi chung là chứng từ)
DANH_SACH_CHUNG_TU_THEO_LOAI= \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.KEM_THEO, CT.LOAI_TIEN, CT.TY_GIA, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.FULL_NAME COLLATE utf8_general_ci AS TEN_DT , '' AS MA_THUE, CT_DT.DEPARTMENT COLLATE utf8_general_ci AS DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, EMPLOYEE_INFO AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=TK.MA_CT AND CT.LOAI_CT=? AND CT.MA_DT=CT_DT.EMPLOYEE_ID AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=1 \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.KEM_THEO, CT.LOAI_TIEN, CT.TY_GIA, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_KH AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, KHACH_HANG AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=TK.MA_CT AND CT.LOAI_CT=? AND CT.MA_DT=CT_DT.MA_KH AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT IN (2, 4) \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.KEM_THEO, CT.LOAI_TIEN, CT.TY_GIA, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_NCC AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, NHA_CUNG_CAP AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=TK.MA_CT AND CT.LOAI_CT=? AND CT.MA_DT=CT_DT.MA_NCC AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=3 \
	ORDER BY NGAY_HT DESC, MA_CT


## Lấy thông tin chứng từ theo maCt
LAY_CHUNG_TU_THEO_MACT=SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.FULL_NAME COLLATE utf8_general_ci AS TEN_DT , '' AS MA_THUE, CT_DT.DEPARTMENT COLLATE utf8_general_ci AS DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, EMPLOYEE_INFO AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=? AND CT.MA_CT=TK.MA_CT AND CT.MA_DT=CT_DT.EMPLOYEE_ID AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=1 \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_KH AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, KHACH_HANG AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=? AND CT.MA_CT=TK.MA_CT AND CT.MA_DT=CT_DT.MA_KH AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT IN (2, 4) \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_NCC AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, NHA_CUNG_CAP AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=? AND CT.MA_CT=TK.MA_CT AND CT.MA_DT=CT_DT.MA_NCC AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=3 \
	ORDER BY NGAY_HT DESC, MA_CT
	
## Lấy thông tin chứng từ theo maCt và loaiCt
LAY_CHUNG_TU_THEO_MACT_LOAICT=SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.FULL_NAME COLLATE utf8_general_ci AS TEN_DT , '' AS MA_THUE, CT_DT.DEPARTMENT COLLATE utf8_general_ci AS DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, EMPLOYEE_INFO AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=? AND CT.LOAI_CT=? AND CT.MA_CT=TK.MA_CT AND CT.MA_DT=CT_DT.EMPLOYEE_ID AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=1 \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_KH AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, KHACH_HANG AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=? AND CT.LOAI_CT=? AND CT.MA_CT=TK.MA_CT AND CT.MA_DT=CT_DT.MA_KH AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT IN (2, 4) \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_NCC AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, NHA_CUNG_CAP AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=? AND CT.LOAI_CT=? AND CT.MA_CT=TK.MA_CT AND CT.MA_DT=CT_DT.MA_NCC AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=3 \
	ORDER BY NGAY_HT DESC, MA_CT

## Lấy thông tin chuẩn bị cho form tạo mới chứng từ
DANH_SACH_LOAI_TIEN= SELECT * FROM NGOAI_TE WHERE THEO_DOI=1 ORDER BY TEN_NT DESC

DANH_SACH_NHAN_VIEN_THEO_MA_HOAC_TEN=SELECT * FROM EMPLOYEE_INFO WHERE EMPLOYEE_ID LIKE ('%?%') OR FULL_NAME LIKE ('%?%')
DANH_SACH_KHACH_HANG_THEO_MA_HOAC_TEN=SELECT * FROM KHACH_HANG WHERE (MA_KH LIKE ('%?%') OR TEN_KH LIKE ('%?%')) AND MA_KH!=1
DANH_SACH_NHA_CUNG_CAP_THEO_MA_HOAC_TEN=SELECT * FROM NHA_CUNG_CAP WHERE MA_NCC LIKE ('%?%') OR TEN_NCC LIKE ('%?%')

DANH_SACH_TAI_KHOAN_THEO_CAP1 = SELECT * FROM TAI_KHOAN_DANH_MUC WHERE MA_TK LIKE ('?%')

## Đếm số chứng từ theo loại và theo năm để đánh số chứng từ
DEM_SO_CHUNG_TU=SELECT COUNT(SO_CT) FROM CHUNG_TU WHERE LOAI_CT=? AND YEAR(NGAY_LAP)=?

## Thêm chứng từ
THEM_CHUNG_TU=INSERT INTO CHUNG_TU(SO_CT, LOAI_CT, NGAY_LAP, NGAY_HT, LY_DO, LOAI_TIEN, TY_GIA, KEM_THEO, MA_DT, LOAI_DT, NGUOI_NOP) VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
THEM_CHUNG_TU_TAI_KHOAN=INSERT INTO CHUNG_TU_TAI_KHOAN (MA_CT, MA_TK, SO_TIEN, SO_DU, LY_DO) VALUES(?, ?, ?, ?, ?)
XOA_CHUNG_TU = DELETE FROM CHUNG_TU WHERE MA_CT=?
XOA_CHUNG_TU_THEO_MACT_LOAICT = DELETE FROM CHUNG_TU WHERE MA_CT=? AND LOAI_CT=?
XOA_CHUNG_TU_TAI_KHOAN=DELETE FROM CHUNG_TU_TAI_KHOAN WHERE MA_CT=?
CAP_NHAT_CHUNG_TU=UPDATE CHUNG_TU SET SO_CT=?, LOAI_CT=?, NGAY_LAP=?, NGAY_HT=?, LY_DO=?, LOAI_TIEN=?, TY_GIA=?, KEM_THEO=?, MA_DT=?, LOAI_DT=?, NGUOI_NOP=? WHERE MA_CT=?
CAP_NHAT_CHUNG_TU_TAI_KHOAN=UPDATE CHUNG_TU_TAI_KHOAN SET SO_TIEN=?, SO_DU=?, LY_DO=? WHERE MA_CT=? AND MA_TK=?


## Sổ kế toán
# Nhật ký chung
DANH_SACH_CHUNG_TU_NHAT_KY_CHUNG_THEO_DIEU_KIEN= \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.FULL_NAME COLLATE utf8_general_ci AS TEN_DT , '' AS MA_THUE, CT_DT.DEPARTMENT COLLATE utf8_general_ci AS DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, EMPLOYEE_INFO AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=TK.MA_CT AND CT.MA_DT=CT_DT.EMPLOYEE_ID AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=1 $DIEU_KIEN_LOAI_CT$ AND NGAY_HT >= ? AND NGAY_HT <= ? \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_KH AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, KHACH_HANG AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=TK.MA_CT AND CT.MA_DT=CT_DT.MA_KH AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT IN (2, 4) $DIEU_KIEN_LOAI_CT$ AND NGAY_HT >= ? AND NGAY_HT <= ? \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_NCC AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS TK_LY_DO, TKDM.TEN_TK, NT.TEN_NT \
	FROM CHUNG_TU AS CT, NHA_CUNG_CAP AS CT_DT, CHUNG_TU_TAI_KHOAN AS TK, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
	WHERE CT.MA_CT=TK.MA_CT AND CT.MA_DT=CT_DT.MA_NCC AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=3 $DIEU_KIEN_LOAI_CT$ AND NGAY_HT >= ? AND NGAY_HT <= ? \
	ORDER BY NGAY_HT DESC, MA_CT DESC

# Sổ kế toán theo từng loại tài khoản: sổ tiền mặt (111), tiền gửi ngân hàng (112), công nợ khách hàng (131) 
DANH_SACH_NGHIEP_VU_KE_TOAN_THEO_MA_TAI_KHOAN=SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.FULL_NAME COLLATE UTF8_GENERAL_CI AS TEN_DT , '' AS MA_THUE, CT_DT.DEPARTMENT COLLATE UTF8_GENERAL_CI AS DIA_CHI, TKNO.MA_TK AS MA_TK_NO, TKDMNO.TEN_TK AS TEN_TK_NO, TKNO.SO_TIEN AS SO_TIEN_NO, TKNO.LY_DO AS LY_DO_NO, TKCO.MA_TK AS MA_TK_CO, TKDMCO.TEN_TK AS TEN_TK_CO, TKCO.SO_TIEN AS SO_TIEN_CO, TKCO.LY_DO AS LY_DO_CO, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TKNO, CHUNG_TU_TAI_KHOAN AS TKCO, EMPLOYEE_INFO AS CT_DT, TAI_KHOAN_DANH_MUC AS TKDMNO, TAI_KHOAN_DANH_MUC AS TKDMCO, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TKNO.MA_CT AND CT.MA_CT=TKCO.MA_CT AND TKNO.SO_DU=-1 AND TKCO.SO_DU=1 AND CT.MA_DT=CT_DT.EMPLOYEE_ID AND TKNO.MA_TK=TKDMNO.MA_TK AND TKCO.MA_TK=TKDMCO.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=1 AND (TKNO.MA_TK LIKE '?%' OR TKCO.MA_TK LIKE '?%') \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_KH AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TKNO.MA_TK AS MA_TK_NO, TKDMNO.TEN_TK AS TEN_TK_NO, TKNO.SO_TIEN AS SO_TIEN_NO, TKNO.LY_DO AS LY_DO_NO, TKCO.MA_TK AS MA_TK_CO, TKDMCO.TEN_TK AS TEN_TK_CO, TKCO.SO_TIEN AS SO_TIEN_CO, TKCO.LY_DO AS LY_DO_CO, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TKNO, CHUNG_TU_TAI_KHOAN AS TKCO, KHACH_HANG AS CT_DT, TAI_KHOAN_DANH_MUC AS TKDMNO, TAI_KHOAN_DANH_MUC AS TKDMCO, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TKNO.MA_CT AND CT.MA_CT=TKCO.MA_CT AND TKNO.SO_DU=-1 AND TKCO.SO_DU=1 AND CT.MA_DT=CT_DT.MA_KH AND TKNO.MA_TK=TKDMNO.MA_TK AND TKCO.MA_TK=TKDMCO.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT IN (2, 4) AND (TKNO.MA_TK LIKE '?%' OR TKCO.MA_TK LIKE '?%') \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_NCC AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TKNO.MA_TK AS MA_TK_NO, TKDMNO.TEN_TK AS TEN_TK_NO, TKNO.SO_TIEN AS SO_TIEN_NO, TKNO.LY_DO AS LY_DO_NO, TKCO.MA_TK AS MA_TK_CO, TKDMCO.TEN_TK AS TEN_TK_CO, TKCO.SO_TIEN AS SO_TIEN_CO, TKCO.LY_DO AS LY_DO_CO, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TKNO, CHUNG_TU_TAI_KHOAN AS TKCO, NHA_CUNG_CAP AS CT_DT, TAI_KHOAN_DANH_MUC AS TKDMNO, TAI_KHOAN_DANH_MUC AS TKDMCO, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TKNO.MA_CT AND CT.MA_CT=TKCO.MA_CT AND TKNO.SO_DU=-1 AND TKCO.SO_DU=1 AND CT.MA_DT=CT_DT.MA_NCC AND TKNO.MA_TK=TKDMNO.MA_TK AND TKCO.MA_TK=TKDMCO.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=3 AND (TKNO.MA_TK LIKE '?%' OR TKCO.MA_TK LIKE '?%') \
	ORDER BY NGAY_HT DESC, MA_CT DESC
	
DANH_SACH_NGHIEP_VU_KE_TOAN_THEO_DIEU_KIEN=SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.FULL_NAME COLLATE UTF8_GENERAL_CI AS TEN_DT , '' AS MA_THUE, CT_DT.DEPARTMENT COLLATE UTF8_GENERAL_CI AS DIA_CHI, TKNO.MA_TK AS MA_TK_NO, TKDMNO.TEN_TK AS TEN_TK_NO, TKNO.SO_TIEN AS SO_TIEN_NO, TKNO.LY_DO AS LY_DO_NO, TKCO.MA_TK AS MA_TK_CO, TKDMCO.TEN_TK AS TEN_TK_CO, TKCO.SO_TIEN AS SO_TIEN_CO, TKCO.LY_DO AS LY_DO_CO, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TKNO, CHUNG_TU_TAI_KHOAN AS TKCO, EMPLOYEE_INFO AS CT_DT, TAI_KHOAN_DANH_MUC AS TKDMNO, TAI_KHOAN_DANH_MUC AS TKDMCO, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TKNO.MA_CT AND CT.LOAI_CT<>'KTTH' AND CT.MA_CT=TKCO.MA_CT AND TKNO.SO_DU=-1 AND TKCO.SO_DU=1 AND CT.MA_DT=CT_DT.EMPLOYEE_ID AND TKNO.MA_TK=TKDMNO.MA_TK AND TKCO.MA_TK=TKDMCO.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=1 AND (TKNO.MA_TK LIKE '$MA_TK$%' OR TKCO.MA_TK LIKE '$MA_TK$%') $DIEU_KIEN_LOAI_CT$ AND NGAY_HT >= ? AND NGAY_HT <= ? \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_KH AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TKNO.MA_TK AS MA_TK_NO, TKDMNO.TEN_TK AS TEN_TK_NO, TKNO.SO_TIEN AS SO_TIEN_NO, TKNO.LY_DO AS LY_DO_NO, TKCO.MA_TK AS MA_TK_CO, TKDMCO.TEN_TK AS TEN_TK_CO, TKCO.SO_TIEN AS SO_TIEN_CO, TKCO.LY_DO AS LY_DO_CO, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TKNO, CHUNG_TU_TAI_KHOAN AS TKCO, KHACH_HANG AS CT_DT, TAI_KHOAN_DANH_MUC AS TKDMNO, TAI_KHOAN_DANH_MUC AS TKDMCO, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TKNO.MA_CT AND CT.LOAI_CT<>'KTTH' AND CT.MA_CT=TKCO.MA_CT AND TKNO.SO_DU=-1 AND TKCO.SO_DU=1 AND CT.MA_DT=CT_DT.MA_KH AND TKNO.MA_TK=TKDMNO.MA_TK AND TKCO.MA_TK=TKDMCO.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT IN (2, 4) AND (TKNO.MA_TK LIKE '$MA_TK$%' OR TKCO.MA_TK LIKE '$MA_TK$%') $DIEU_KIEN_LOAI_CT$ AND NGAY_HT >= ? AND NGAY_HT <= ? \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_NCC AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TKNO.MA_TK AS MA_TK_NO, TKDMNO.TEN_TK AS TEN_TK_NO, TKNO.SO_TIEN AS SO_TIEN_NO, TKNO.LY_DO AS LY_DO_NO, TKCO.MA_TK AS MA_TK_CO, TKDMCO.TEN_TK AS TEN_TK_CO, TKCO.SO_TIEN AS SO_TIEN_CO, TKCO.LY_DO AS LY_DO_CO, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TKNO, CHUNG_TU_TAI_KHOAN AS TKCO, NHA_CUNG_CAP AS CT_DT, TAI_KHOAN_DANH_MUC AS TKDMNO, TAI_KHOAN_DANH_MUC AS TKDMCO, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TKNO.MA_CT AND CT.LOAI_CT<>'KTTH' AND CT.MA_CT=TKCO.MA_CT AND TKNO.SO_DU=-1 AND TKCO.SO_DU=1 AND CT.MA_DT=CT_DT.MA_NCC AND TKNO.MA_TK=TKDMNO.MA_TK AND TKCO.MA_TK=TKDMCO.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=3 AND (TKNO.MA_TK LIKE '$MA_TK$%' OR TKCO.MA_TK LIKE '$MA_TK$%') $DIEU_KIEN_LOAI_CT$ AND NGAY_HT >= ? AND NGAY_HT <= ? \
	ORDER BY NGAY_HT DESC, MA_CT DESC
	
DANH_SACH_NGHIEP_VU_KE_TOAN_KTTH_THEO_DIEU_KIEN=SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.FULL_NAME COLLATE UTF8_GENERAL_CI AS TEN_DT , '' AS MA_THUE, CT_DT.DEPARTMENT COLLATE UTF8_GENERAL_CI AS DIA_CHI, TK.MA_TK AS MA_TK, TKDM.TEN_TK AS TEN_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS LY_DO, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TK, EMPLOYEE_INFO AS CT_DT, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TK.MA_CT AND CT.LOAI_CT='KTTH' AND CT.MA_DT=CT_DT.EMPLOYEE_ID AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=1 AND TK.MA_TK LIKE '$MA_TK$%' AND NGAY_HT >= ? AND NGAY_HT <= ? \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_KH AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK AS MA_TK, TKDM.TEN_TK AS TEN_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS LY_DO, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TK, KHACH_HANG AS CT_DT, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TK.MA_CT AND CT.LOAI_CT='KTTH' AND CT.MA_DT=CT_DT.MA_KH AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT IN (2, 4) AND TK.MA_TK LIKE '$MA_TK$%' AND NGAY_HT >= ? AND NGAY_HT <= ? \
	UNION \
	SELECT CT.MA_CT, CT.SO_CT, CT.LOAI_CT, CT.NGAY_LAP, CT.NGAY_HT, CT.LY_DO, CT.LOAI_TIEN, CT.TY_GIA, CT.KEM_THEO, CT.MA_DT, CT.LOAI_DT, CT.NGUOI_NOP, CT_DT.TEN_NCC AS TEN_DT, CT_DT.MA_THUE, CT_DT.DIA_CHI, TK.MA_TK AS MA_TK, TKDM.TEN_TK AS TEN_TK, TK.SO_TIEN, TK.SO_DU, TK.LY_DO AS LY_DO, NT.TEN_NT \
		FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TK, NHA_CUNG_CAP AS CT_DT, TAI_KHOAN_DANH_MUC AS TKDM, NGOAI_TE AS NT \
		WHERE CT.MA_CT=TK.MA_CT AND CT.LOAI_CT='KTTH' AND CT.MA_DT=CT_DT.MA_NCC AND TK.MA_TK=TKDM.MA_TK AND CT.LOAI_TIEN=NT.MA_NT AND CT.LOAI_DT=3 AND TK.MA_TK LIKE '$MA_TK$%' AND NGAY_HT >= ? AND NGAY_HT <= ? \
	ORDER BY NGAY_HT DESC, MA_CT DESC

TONG_PHAT_SINH=SELECT SUM(TK.SO_TIEN*CT.TY_GIA) FROM CHUNG_TU AS CT, CHUNG_TU_TAI_KHOAN AS TK WHERE CT.MA_CT=TK.MA_CT AND TK.MA_TK=? AND TK.SO_DU=? $DIEU_KIEN_BAT_DAT$ $DIEU_KIEN_KET_THUC$ GROUP BY TK.MA_TK, TK.SO_DU


